<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width; initial-scale = 1.0;" />
    <title>Mocking your application state with gen_fsm</title>
    <link href="../../style.css" rel="stylesheet"/>

    
  </head>
  <body>
    <header> 
  
  <nav>
    <ul>       
      <li><a href="/">staticshin</a></li>
      <li><a href="/about.html">about</a></li>
      <li><a href="/archives.html">archives</a></li>
      <li title="more" id="more-menu">[...]</li>
    </ul>
  </nav>
  <div class="grid grid-pad nav-grid" style="display:none">
      <div class="col-1-3">
	<h3>Popular Posts</h3>
        <ol>
          <li><a href="/knife-in-the-water">Knife in the water</a></li>
          <li><a href="/understanding-punctuation-in-erlang">Understanding punctuation in erlang</a></li>
          <li><a href="/absurdity-keeler-webwork-and-nis">Absurdity, Keeler, webwork and NIS </a></li>
          <li><a href="/rayman-origins-is-a-silly-little-game">Rayman origins is a silly little game</a></li>
          <li><a href="/dead-man">Dead man</a></li>
        </ol>
      </div>
      <div class="col-1-3">
	<h3>Also on staticshin</h3>
        <a href="/programming">Thoughts on programming</a>
      </div>
      <div class="col-1-3">
      </div>
    </div>
</header>

    <div class="grid grid-pad">
      <div class="col-8-12 push-2-12">
	<h1>Mocking your application state with gen_fsm</h1>
	<span>Akshat Jiwan Sharma,  Mon Mar 16 2015</span>
	<div class="postBody"><p>gen_fsm is a generic finite state machine behaviour in erlang. And as the name suggests gen_fsm allows us to model state machines.</p>
<p>"What is a finite state machine?"</p>
<p>A finite state machine is a logical machine. Much like a bicycle which is a mechanical machine. A bicycle exists in two states:- a stationary state (where it just stands) and  in motion (when the tires are moving and it's doing the work that it's supposed to do, fulfilling it's life's purpose so to speak. When I think about it bicycles have it easy. All they have to do is move those tires <em>sigh</em>). A force is needed to transform the state from stationary to motion and from motion to stationary. Let's try to model the logical machine for the bicycle. </p>
<pre><code>Stationary--cycling--&gt;Motion
|            
|            
|            
Force</code></pre>
<p>Simple right? This is what in essence a finite state machine is. But we can do better. Let us try to derive a formal definition:-</p>
<p>A finite state machine is a logical machine that can exist in one of the many states. But only one at a time. A cycle can either be moving or stationary. An event is needed to transform from one state to another. Like how a force must be applied on a stationary cycle to make it move.</p>
<pre><code>State1--Acton--&gt;State2
|            
|            
|            
Event1</code></pre>
<p><em>Fsm</em>(s) can be used to model the states of our applications for the purpose of testing it's behaviour. Though an fsm can be created in any programming language erlang gives us the upper hand by abstracting out all the generic stuff into a  reusable library. So all we have to do is write the specifics of our fsm. </p>
<p>"Cool but I don't know any erlang"</p>
<p>No worries. Erlang is the easy. So easy in fact that all you need is just <a href="http://learnxinyminutes.com/docs/erlang/">15 minutes of free time</a>. And after reading this post you will have a very good reason to use it in your application. Ready? So here is what we will be doing:-  </p>
<p>We have a web application. Very basic. Our application starts, creating the database and doing some other housekeeping stuff. A landlord logs into our application. He adds a tenant. The application sends an email to the tenant seeking permission to aproove the landlord. When the due date of rent draws another email is sent. The tenant then pays the rent. When the tenant leaves the house the contract between the landlord and the tenant is terminated.</p>
<p>So if we make a state diagram of our application it should look something like this:-</p>
<pre><code>prepare_database-&gt;add_tenant-&gt;approve_landlord-&gt;notify_due_rent-&gt;pay_rent-&gt;end_contract
|
|
|
start</code></pre>
<p>This diagram is not much different from other state diagrams that we considered above. Yes there are a lot more states but it is still pretty straigtforward. Now all these states are exposed in the form of http endpoints. For example the <code>add_tenant</code> state is reachable in our application from <code>\add_ten</code> url. What we will do is to call the endpoints of each of these states one by one and run some tests against our database to see if our records in the database reflect the state of our application given by the url.</p>
<script src="https://gist.github.com/brickcap/c28027ea448ea2968ea7.js"></script>


<p><strong>The TDD approach</strong></p>
</div>
      </div>
    </div>
    <div id="disqus_thread"></div>
    <hr/>
    <footer>
      <h1>Thank you for reading</h1>
    </footer>
    <noscript>
      Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
<div>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'staticshin'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function ()
  {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37138783-1']);
  _gaq.push(['_trackPageview']);

  (function ()
  {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script src="../../staticshin.js"> </script>

</body>

</html>
