<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <title>Kubernetes</title>
    <link href="/study/index.css" rel="stylesheet"/>
  </head>
  <body>
    <h1>Kubernetes</h1>
    <p>It seems that Kubernetes is a "platform independent" (it works with docker as well as rkt) container management tool. Among other things it allows me to perform updates to running containers. This greatly simplifies my work as I won't have to build my own <a href="/study/docker.html#prop_updates">update propagation</a> chain.  </p>
    <p id="docker_swarm"><s>However most of the features that I need from kubernetes are also available natively in docker swarm. So I will be sticking to that.</s></p>
    <p id="consider_this">One point about kubernetes that I hadn't considered before was that it allows me to run my app in a managed google container engine environment. Which means that I can provision on demand servers from google itself. If I <a href="#docker_swarm">go with docker swarm</a> I'm on my own and I'll have to manage and deploy apps by writing programs. This will make my job harder. Amazon does offer an <a href="/study/infrastructure.html#ecs">elastic container service</a> but that is very costly because first it forces me to use multiple amazon services and second it locks me in.
      Therefore I'm looking into kubernetes again.</p>
    <p>Kubernetes instead of deploying containers works with a concept of pods. A pod may contain one or more containers which run in a shared context within the same nod. All the containers within a pod are networked with each other.</p>
    <p>It is important to remember that in the dev mode minikube assigns the ip address to our virtual node. So that to get the ip address we must use the built in command <small>sudo minikube service $service_name --url
      </small>
    </p>
    <p><strong>A word on scaling and replicas</strong></p>
    <div>
      <p>Scaling in kubernetes refers to increasing/decreasing the number of replicas in the deployment. Now replication of has been a bit difficult for me to understand. What I want to achieve is ability to run multiple instances of an app. Now this comes quite close to what replication does but it does not solve my problem. Why?</p>
      <p>Because kubernetes distributes traffic automatically among all the available pods. While it's good for scaling the app and distributing traffic this is not what I want. Instead I need a node to host pods for a particular client. So it's more like multiple nodes and each of the node having multiple pods (which refer to the services used by a client)</p>
      <p>Consider a building. Each building has multiple apartments. A tenant owns an apartment and he may have his stuff within that apartment. The way I'm seeing things right now is :- Kubernetes master is the building. A node is an apartment and pods is all the stuff in the apartment. I need to create apartments for my customers.</p>
      <p>Since each apartment or node will be a physical server I'll have to be very careful about what <a href="/study/infrastructure.html">infrastructure provider</a> I use.  We need to keep the costs of provisioning and monitoring new nodes as low as possible. With this point in mind <a href="#consider_this">Amazon ECS</a> looks pretty expensive to me.</p>
      <p><strong>A word on rolling updates</strong></p>
      <p>Kubernetes performs rolling updates by creating new pods with an image description and then terminating the existing pods. This raises two important implications for our architecture:- </p>
      <ol>
          <li>Since we are designing one service pod per node architecture we need to plan for unavailability/maintenance of apps</li>
          <li>
	    It would be best if app containers could simply update themselves via a <a href="/study/docker.html#prop_updates">git repo</a> the same idea which we considered with docker.
	  </li>
          <li>I can't think of a scenario in production where rollback would be useful. The update is so heavy with creation and deletion of pods that if I ever take the plunge to update I'll make sure that I won't have to roll back under any circumstance.</li>
      </ol>
    </div>

    <p><small>-- <a href="/about.html">Akshat Jiwan Sharma</a></small></p>     
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37138783-1']);
      _gaq.push(['_trackPageview']);

      (function ()
      {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    <script src="/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="/study/index.js" type="text/javascript"></script>

  </body>
</html>



